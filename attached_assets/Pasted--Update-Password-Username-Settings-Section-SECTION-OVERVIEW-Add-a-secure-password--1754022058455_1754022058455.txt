## **Update Password/Username Settings Section**

### **SECTION OVERVIEW**
Add a secure password and username update system within the settings panel that requires current password verification for any changes.

---

### **1. SETTINGS PANEL INTEGRATION**

#### **Add to Account Settings Section:**
```
┌─────────────────────────────┐
│ 👤 Account Settings         │
├─────────────────────────────┤
│ Profile Information         │
│ Name: TeamThink             │
│ Email: team@email.com       │
│ Phone: +1 234-567-8900      │
│ [Edit Profile]              │
│                             │
│ Security & Access           │ ← NEW SECTION
│ [Change Password]           │ ← NEW
│ [Update Username]           │ ← NEW
│                             │
│ Login Methods               │
│ ✓ Email ✓ Username ✓ Phone │
│                             │
│ Two-Factor Authentication   │
│ [Setup 2FA]                 │
└─────────────────────────────┘
```

---

### **2. CHANGE PASSWORD FLOW**

#### **Step 1 - Initial Click:**
User clicks **[Change Password]** button in settings

#### **Step 2 - Challenge Modal Appears:**
```
┌─────────────────────────────────────┐
│ Change Password              [×]    │
├─────────────────────────────────────┤
│                                     │
│ 🔒 Verify Your Identity             │
│                                     │
│ Enter your current password to      │
│ make changes to your account        │
│                                     │
│ Current Password                    │
│ [____________________] [👁]         │
│                                     │
│ [      Verify & Continue      ]     │
│                                     │
│ ─────────── Need Help? ───────────  │
│                                     │
│ Forgot your password?               │
│ [Reset Password Instead]            │
│                                     │
│ Can't remember your username?       │
│ [Recover Username]                  │
│                                     │
└─────────────────────────────────────┘
```

#### **Step 3 - After Successful Verification:**
```
┌─────────────────────────────────────┐
│ Create New Password          [×]    │
├─────────────────────────────────────┤
│                                     │
│ ✅ Identity Verified                │
│                                     │
│ New Password                        │
│ [____________________] [👁]         │
│ Strength: [████░░] Strong           │
│                                     │
│ Confirm New Password                │
│ [____________________] [👁]         │
│                                     │
│ Password Requirements:              │
│ ✓ At least 8 characters            │
│ ✓ Mix of letters and numbers       │
│ ✓ At least 1 special character     │
│                                     │
│ [    Update Password    ]           │
│                                     │
└─────────────────────────────────────┘
```

---

### **3. UPDATE USERNAME FLOW**

#### **Step 1 - Initial Click:**
User clicks **[Update Username]** button in settings

#### **Step 2 - Challenge Modal:**
```
┌─────────────────────────────────────┐
│ Update Username              [×]    │
├─────────────────────────────────────┤
│                                     │
│ 🔒 Verify Your Identity             │
│                                     │
│ Enter your current password to      │
│ change your username                │
│                                     │
│ Current Username: TeamThink         │
│                                     │
│ Current Password                    │
│ [____________________] [👁]         │
│                                     │
│ [      Verify & Continue      ]     │
│                                     │
│ ─────────── Need Help? ───────────  │
│                                     │
│ Forgot your password?               │
│ [Reset Password Instead]            │
│                                     │
│ Can't remember your username?       │
│ [Recover Username]                  │
│                                     │
└─────────────────────────────────────┘
```

#### **Step 3 - After Successful Verification:**
```
┌─────────────────────────────────────┐
│ Choose New Username          [×]    │
├─────────────────────────────────────┤
│                                     │
│ ✅ Identity Verified                │
│                                     │
│ Current Username: TeamThink         │
│                                     │
│ New Username                        │
│ [____________________]              │
│ ✅ Available / ❌ Taken             │
│                                     │
│ Username Requirements:              │
│ • 3-20 characters                   │
│ • Letters, numbers, underscore only │
│ • Must start with letter           │
│ • Cannot be changed for 30 days     │
│                                     │
│ [     Update Username     ]         │
│                                     │
└─────────────────────────────────────┘
```

---

### **4. HELP LINK ACTIONS**

#### **"Reset Password Instead" Flow:**
```
┌─────────────────────────────────────┐
│ Reset Password               [×]    │
├─────────────────────────────────────┤
│                                     │
│ 📧 Password Reset                   │
│                                     │
│ We'll send a reset link to your     │
│ registered email address            │
│                                     │
│ Email: t***@email.com               │
│                                     │
│ [    Send Reset Link    ]           │
│                                     │
│ ─────────────────────────────       │
│                                     │
│ Or choose a different method:       │
│                                     │
│ [📱 Send to Phone] [❓ Security Qs] │
│                                     │
└─────────────────────────────────────┘
```

#### **"Recover Username" Flow:**
```
┌─────────────────────────────────────┐
│ Recover Username             [×]    │
├─────────────────────────────────────┤
│                                     │
│ 📧 Username Recovery                │
│                                     │
│ We'll send your username to your    │
│ registered contact methods          │
│                                     │
│ Send to:                            │
│ ☑️ Email: t***@email.com            │
│ ☑️ Phone: +1 ***-***-8900           │
│                                     │
│ [   Send Username Info   ]          │
│                                     │
└─────────────────────────────────────┘
```

---

### **5. SUCCESS/ERROR STATES**

#### **Success Messages:**
```
┌─────────────────────────────────────┐
│ ✅ Password Updated Successfully    │
├─────────────────────────────────────┤
│ Your password has been changed.     │
│ You'll remain logged in on this     │
│ device, but will need to sign in    │
│ again on other devices.             │
│                                     │
│ [        Got It        ]            │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ ✅ Username Updated Successfully    │
├─────────────────────────────────────┤
│ Your username is now: NewUsername   │
│                                     │
│ Note: You can't change your         │
│ username again for 30 days.         │
│                                     │
│ [        Got It        ]            │
└─────────────────────────────────────┘
```

#### **Error Messages:**
```
┌─────────────────────────────────────┐
│ ❌ Incorrect Password               │
├─────────────────────────────────────┤
│ The password you entered is         │
│ incorrect. Please try again.        │
│                                     │
│ Attempts remaining: 2 of 3          │
│                                     │
│ [       Try Again       ]           │
│                                     │
│ [   Reset Password Instead   ]      │
└─────────────────────────────────────┘
```

---

### **6. TECHNICAL IMPLEMENTATION**

#### **Database Schema Updates:**
```sql
-- Track password change attempts
CREATE TABLE password_change_attempts (
    id UUID PRIMARY KEY,
    user_id UUID REFERENCES users(id),
    ip_address INET,
    successful BOOLEAN,
    attempted_at TIMESTAMP DEFAULT NOW()
);

-- Track username changes (rate limiting)
CREATE TABLE username_changes (
    id UUID PRIMARY KEY,
    user_id UUID REFERENCES users(id),
    old_username VARCHAR(50),
    new_username VARCHAR(50),
    changed_at TIMESTAMP DEFAULT NOW()
);
```

#### **API Endpoints:**
```
POST /api/user/verify-password
- Verify current password for changes
- Rate limit: 3 attempts per 15 minutes

PATCH /api/user/password
- Update password with verification token
- Invalidate other sessions

PATCH /api/user/username
- Update username with verification token
- Check availability and rate limits

GET /api/user/username-availability
- Real-time username availability check

POST /api/user/password-reset
- Initiate password reset flow

POST /api/user/username-recovery
- Send username to contact methods
```

#### **Frontend Components:**
```tsx
// Challenge Modal Component
const ChallengeModal = ({ type, onSuccess, onCancel }) => {
  const [password, setPassword] = useState('');
  const [attempts, setAttempts] = useState(0);
  const [isVerifying, setIsVerifying] = useState(false);

  const handleVerify = async () => {
    setIsVerifying(true);
    try {
      const response = await verifyPassword(password);
      if (response.success) {
        onSuccess(response.token);
      } else {
        setAttempts(prev => prev + 1);
        // Show error
      }
    } catch (error) {
      // Handle error
    } finally {
      setIsVerifying(false);
    }
  };

  return (
    <Modal>
      {/* Challenge UI */}
    </Modal>
  );
};

// Password Update Component
const UpdatePasswordModal = ({ verificationToken, onClose }) => {
  // Password update form
};

// Username Update Component  
const UpdateUsernameModal = ({ verificationToken, onClose }) => {
  // Username update form with availability check
};
```

---

### **7. SECURITY FEATURES**

#### **Rate Limiting:**
- **3 verification attempts** per 15 minutes
- **Account lockout** after 5 failed attempts in 1 hour
- **Username changes** limited to once per 30 days

#### **Session Management:**
- **Password changes** invalidate other sessions
- **Username changes** don't affect current session
- **Verification tokens** expire after 10 minutes

#### **Audit Trail:**
- **Log all attempts** (successful and failed)
- **Track IP addresses** for security monitoring
- **Email notifications** for successful changes

#### **Input Validation:**
- **Password strength** requirements
- **Username format** validation
- **Real-time availability** checking
- **XSS/injection** protection

---

### **8. REPLIT IMPLEMENTATION CHECKLIST**

**Phase 1 - Backend Security:**
- [ ] Create verification endpoints
- [ ] Implement rate limiting
- [ ] Add audit logging
- [ ] Set up session invalidation

**Phase 2 - Challenge System:**
- [ ] Build challenge modal component
- [ ] Add password verification logic
- [ ] Implement help link actions
- [ ] Create error handling

**Phase 3 - Update Forms:**
- [ ] Password update modal
- [ ] Username update with availability
- [ ] Success/error notifications
- [ ] Form validation

**Phase 4 - Integration:**
- [ ] Add to settings panel
- [ ] Connect with existing auth
- [ ] Test security measures
- [ ] Mobile responsiveness

This system provides secure, user-friendly password and username updates while maintaining strong security practices and clear user guidance through the help links.